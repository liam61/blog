# JS mobx æºç è§£è¯»ï¼ˆä¸€ï¼‰ï¼šä»é›¶åˆ° observable ä¸€ä¸ª object å¦‚ä½•

æ–‡æœ¬æ˜¯ [mobx æºç è§£è¯»ç³»åˆ—](https://github.com/lawler61/blog/labels/mobx%20%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB) ç¬¬ä¸€ç¯‡

æœ¬ç³»åˆ—æ–‡ç« å…¨éƒ¨é‡‡ç”¨ mobx è¾ƒæ–°ç‰ˆæœ¬ï¼š[v5.13.0](https://github.com/lawler61/mobx)

## æŠ€æœ¯å‰æ

åœ¨é˜…è¯»ä¹‹å‰ï¼Œå¸Œæœ›ä½ å¯¹ä»¥ä¸‹æŠ€æœ¯æœ‰æ‰€**äº†è§£æˆ–å®è·µ**ï¼Œä¸ç„¶å¯èƒ½ä¼šå½±å“ä½ å¯¹æœ¬æ–‡çš„ç†è§£

1. [ES6 è£…é¥°å™¨ï¼šdecorator](http://es6.ruanyifeng.com/#docs/decorator)

2. [ES6 ä»£ç†ï¼šproxy](http://es6.ruanyifeng.com/#docs/proxy)

3. [ES6 åå°„ï¼šreflect](http://es6.ruanyifeng.com/#docs/reflect)

4. [å®šä¹‰å¯¹è±¡å±æ€§ï¼šObject.defineProperty](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)

5. [å®ç°ç®€æ˜“ç‰ˆ MVVMï¼ˆå¯é€‰ï¼‰](https://github.com/lawler61/blog/issues/5)

## å‡†å¤‡

### ä¸€ã€ç›®å½•ç»“æ„

```js
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ api // è¿›è¡ŒåŠ«æŒæ–¹æ³•å’Œä½œå‡ºååº”çš„ api
â”‚   â”œâ”€â”€ core // å…¨å±€çŠ¶æ€ã€å‡½æ•°ç­‰
â”‚   â”œâ”€â”€ types // é‡å†™å…³äº objectï¼Œarray ç­‰ç±»å‹çš„ api
â”‚   â”œâ”€â”€ utils // å·¥å…·æ–¹æ³•
â”‚   â”œâ”€â”€ internal.ts
â”‚   â””â”€â”€ mobx.ts // å…¨å±€å¯¼å‡º
â””â”€â”€ package.json
```

### äºŒã€åŠ«æŒåŸç†

ä¸¤ä¸ªå…³é”®è¯ï¼š**å±æ€§åŠ«æŒ**ï¼Œ**é€’å½’**

1. å±æ€§åŠ«æŒï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯åœ¨ç¼–ç¨‹è¯­è¨€å±‚é¢ä¸Šè¿›è¡Œç¼–ç¨‹ï¼Œè¿™ç‚¹åœ¨ `proxy & reflect` ä¸­ä½“ç°çš„å°¤ä¸ºæ˜æ˜¾

2. é€šè¿‡ `Object.defineProperty` æˆ– `proxy` å¯ä»¥å®ç°åœ¨è·å–æˆ–ä¿®æ”¹å¯¹è±¡å±æ€§æ—¶ï¼Œåšä¸€äº›é¢å¤–çš„æ“ä½œ

3. mobx5 ç‰ˆæœ¬é»˜è®¤åŠ«æŒé‡æ„ä¸ºäº† `proxy`ï¼Œä¸»è¦æ˜¯ `proxy` ç›¸å¯¹äº `Object.defineProperty` è¾ƒç¨³å®šï¼Œå¹¶ä¸”åŠ«æŒçš„æ‰‹æ®µæ›´å¤šï¼Œå…·ä½“å°±ä¸å±•å¼€äº†

4. å¯¹è±¡çš„å±æ€§å€¼å¯èƒ½ä¹Ÿæ˜¯ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯å¼•ç”¨ç±»å‹å°±è¿›è¡Œé€’å½’åŠ«æŒ

### ä¸‰ã€æ•´ä½“æ­¥éª¤ï¼ˆæœ¬æ–‡å…ˆåªè®¨è®ºåŠ«æŒå¯¹è±¡ï¼‰

å…ˆå¯¹æ•´ä½“æ­¥éª¤æœ‰ä¸ªå¤§æ¦‚çš„äº†è§£ï¼Œæ–¹ä¾¿åé¢çš„ç†è§£

1. å¤„ç†è£…é¥°å™¨ï¼Œå‡†å¤‡å¥½è£…é¥°å™¨æ‰€éœ€çš„å‚æ•°

> è£…é¥°å™¨ä¹¦å†™æœ‰å¸¦æ‹¬å·å’Œä¸å¸¦æ‹¬å·çš„ï¼Œä½†æœ€åéƒ½è¦æ±‚è¿”å› descriptor
>
> @observable obj ...
>
> @log({ name: 'lawler' }) obj2 ...

2. åŠ«æŒå¯¹è±¡å½“å‰å±‚çš„å±æ€§

> æ ¹æ®å±æ€§å€¼çš„ç±»å‹ï¼Œè°ƒç”¨çš„ç›¸åº” enhancerï¼ˆå³åŠ«æŒå™¨ï¼Œåé¢ä¼šè¯´åˆ°ï¼‰è¿›è¡ŒåŠ«æŒ

3. é€’å½’åŠ«æŒ

> åˆ¤æ–­æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€’å½’åŠ«æŒ

4. æš´éœ²æ“ä½œ apiï¼Œæ–¹ä¾¿ç”¨æˆ·æ“ä½œï¼Œå¦‚ mobx çš„ keys, values, set

## ä¸Šæºç 

æºç æˆªå›¾ä¸Šæœ‰å¾ˆå¤šå¯¹åº”ä»£ç çš„æ³¨é‡Šï¼Œä¹Ÿè¯·ä¸€èµ·é˜…è¯»

### ä¸€ã€observable çš„å®šä¹‰

1. ä» mobx.ts å…¨å±€å¯¼å‡ºï¼Œæ‰¾åˆ° observableï¼ˆsrc/api/observable.tsï¼‰

> å¯ä»¥çœ‹åˆ°ï¼Œobservable ç”¨ createObservable èµ‹å€¼
>
> å¹¶å°† observableFactories çš„ keys éå†ï¼Œå°†å…¶å±æ€§æŒ‚åœ¨ observable ä¸‹ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æŒ‚åœ¨ createObservable ä¸‹ï¼‰

![define observable](./images/1/1.define-observable.jpg)

2. createObservable åŠ«æŒå™¨

> åˆ©ç”¨åˆš observableFactories æŒ‚ä¸Šæ¥çš„ object, array ç­‰å±æ€§ï¼Œæ¥æ ¹æ®å˜é‡ç±»å‹è°ƒç”¨ç›¸åº”æ–¹æ³•åŠ«æŒ
>
> æ³¨æ„ observable å’Œ createObservable æ˜¯ä¸€ä¸ªå¯¹è±¡å¹¶ä¸”åœ¨ç›¸äº’è°ƒç”¨ï¼Œè¿™ä¸ªå¼¯è¦æ³¨æ„

![createObservable](./images/1/2.createObservable.jpg)

3. é‡ç‚¹çœ‹çœ‹ observable.objectï¼Œå³ observableFactories.object

> object å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸º options å¯ä»¥å®šåˆ¶åŒ–åŠ«æŒæ–¹å¼

```js
const person = observable({
  name: 'lawler',
  get labelText() {
    return this.showAge ? `${this.name} (age: ${this.age})` : this.name;
  },
  setAge(age) {
    his.age = age;
  }
}, { // æ­¤ä¸ºç¬¬äºŒä¸ªå‚æ•° decorators
  setAge: action
} /*, è¿™é‡Œä¼ ç¬¬ä¸‰ä¸ª options å‚æ•° */);
```

![observable.object](./images/1/3.observable.object.jpg)

4. asCreateObservableOptions å¤„ç† Options

> å¦‚æœä¸ä¼  options è¿”å›é»˜è®¤çš„ defaultCreateObservableOptionsï¼Œå¦‚æœä¼ äº† options å°±æŒ‰ç…§ç”¨æˆ·å†™çš„æ¥
>
> å›åˆ°ç¬¬ 3 æ­¥ï¼Œå¦‚æœ o.proxy ä¸º false é‡‡ç”¨ `Object.defineProperty` åŠ«æŒï¼Œå¦åˆ™é‡‡ç”¨ `proxy` åŠ«æŒ

![asCreateObservableOptions](./images/1/4.asCreateObservableOptions.jpg)

5. æ ¹æ® options è·å–åˆ°å¯¹åº”å¤„ç†è¯¥ç±»å‹çš„ decoratorï¼Œçœ‹çœ‹ getDefaultDecoratorFromObjectOptions åšäº†ä»€ä¹ˆ

> options.deep é»˜è®¤ä¸º trueï¼Œæ‰€ä»¥é»˜è®¤å– deepDecorator
>
> deepDecorator æ¥è‡ªäº createDecoratorForEnhancerï¼ˆ**è¿™ä¸ªæ˜¯åé¢çš„é‡ç‚¹ï¼Œå…ˆæ”¾è¿™**ï¼‰ï¼Œéœ€è¦ä¼ ä¸€ä¸ªå‚æ•° enhancer
>
> éœ€è¦ deepDecorator å°±ä¼  deepEnhancerï¼›éœ€è¦ shallowDecorator å°±ä¼  shallowEnhancer ...
>
> deepEnhancer å…¶å®å°±æ˜¯æ ¹æ®å˜é‡çš„ä¸åŒç±»å‹ï¼Œè°ƒç”¨ observable çš„ä¸åŒå‚æ•°ï¼Œå¦‚ object, array æ¥è¿›è¡ŒåŠ«æŒ
>
> æœ‰æ²¡æœ‰ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ï¼Œå…¶å®å°±å’Œæ­¥éª¤ 2 çš„ createObservable æ˜¯ä¸€æ ·çš„
>
> ç°åœ¨ä¸€å®šè¦ç‰¢è®°ï¼š**enhancer å…¶å®å°±æ˜¯ä¸€ä¸ªåŠ«æŒå™¨ï¼Œé‡Œé¢æä¾›äº†åŠ«æŒå„ç§ç±»å‹çš„æ–¹æ³•ï¼ˆç›¸å½“äº observableï¼‰**

![getDefaultDecoratorFromObjectOptions](./images/1/5.getDefaultDecoratorFromObjectOptions.jpg)

6. æ¥ä¸‹æ¥ extendObservable é‡Œé¢ä¼ ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¿›è¡Œæ–°äº§ç‰©å±æ€§çš„åˆå§‹åŒ–

> æ‰€ä»¥ @observable obj ... ä¸ä¼šæ”¹å˜åŸæ¥å¯¹è±¡çš„
>
> å¦‚æœ properties ä¸ä¸ºç©ºçš„è¯ï¼ˆå³ Object.defineProperty åŠ«æŒï¼‰åˆ™ç›´æ¥è¿›è¡Œè°ƒç”¨ extendObservableObjectWithProperties
>
> å¦‚æœèµ° proxy åŠ«æŒï¼Œåœ¨è·å–åˆ°ä»£ç†å¯¹è±¡åï¼ˆconst proxy = createDynamicObservableObject(base)ï¼‰ï¼Œä¸»åŠ¨è°ƒç”¨ extendObservableObjectWithPropertiesã€‚è§ `ç« èŠ‚ä¸€ æ­¥éª¤3`
>
> æ‰€ä»¥èƒ½çœ‹å‡ºæ¥è¿™ä¸ªå‡½æ•°ä¸»è¦ç›®çš„å°±æ˜¯åˆå§‹åŒ–ä¸åŒåŠ«æŒæƒ…å†µä¸‹ç›®æ ‡äº§ç‰©çš„å±æ€§ï¼šinitializeInstanceï¼ˆ**è®°ä½è¿™ä¸ªå‡½æ•°ï¼Œåé¢è®²**ï¼‰å’Œ asObservableObject

![extendObservable](./images/1/6.extendObservable.jpg)

7. å„ç§å‚æ•°å‡†å¤‡å®Œæ¯•ï¼Œè¿›è¡Œå½“å‰å±‚çš„åŠ«æŒï¼Œçœ‹çœ‹ extendObservableObjectWithProperties æ€ä¹ˆåšçš„

> for of ä¸ç”¨è¯´
>
> è·å–åˆ°å‡†å¤‡å¥½çš„ç”¨æ¥å¤„ç†è¯¥å¯¹è±¡çš„ decoratorï¼Œç„¶åä¼ å…¥å±æ€§è£…é¥°å™¨éœ€è¦çš„ä¸‰ä¸ªåŸºæœ¬å‚æ•°ï¼štarget, key, descriptor
>
> è¿”å›çš„ç»“æœå°±æ˜¯åŠ«æŒå®Œè¯¥å±æ€§åçš„ resultDescriptorï¼Œå†é€šè¿‡ Object.defineProperty å†™å…¥ targetï¼ˆå³è¢« proxy ä»£ç†çš„ base ç©ºå¯¹è±¡ï¼‰ä¸­
>
> ç”±æ­¤å®Œæˆå½“å‰å±‚çš„å½“å‰ key çš„åŠ«æŒ

![extendObservableObjectWithProperties](./images/1/7.extendObservableObjectWithProperties.jpg)

### äºŒã€decorator é€ ç¥å·¥å…·

ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£å¯ä»¥å‚è€ƒä¸‹ï¼š[codesandbox: decorator demo](https://codesandbox.io/embed/exciting-ardinghelli-xjhbb)

1. æ¨æ•²ä¸‹ decorator çš„æ¥æº

> çœ‹å®Œ `ç« èŠ‚ä¸€ æ­¥éª¤5` ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œä½ æ€ä¹ˆå¾—åˆ°æˆ‘å½“å‰ä»»ä½•è£…é¥°å™¨ã€ä»»ä½•æ•°æ®ç±»å‹ã€ä»»ä½•å®šåˆ¶åŒ–åŠ«æŒçš„ decorator å‡½æ•°çš„
>
> ç°åœ¨å°±å›åˆ°é‚£é‡Œï¼Œä¹‹å‰åŸ‹ä¸‹äº†ä¼ç¬”ï¼šcreateDecoratorForEnhancer
>
> æˆ‘ä»¬ä» getDefaultDecoratorFromObjectOptions å‡ºå‘ï¼Œé‡Œé¢é€šè¿‡è°ƒç”¨ createDecoratorForEnhancer å¹¶ä¼ å…¥ deepEnhancer å¾—åˆ° deepDecorator ä¾›æˆ‘ä»¬ä½¿ç”¨
>
> ç°åœ¨çœ‹çœ‹ createDecoratorForEnhancer æ€ä¹ˆç”Ÿæˆå„ç§ decoratorã€‚è¿™æ˜¯ä¸€ä¸ª**éå¸¸é‡éš¾ç‚¹**ï¼Œè¯·è€å¿ƒåå¤é˜…è¯»

2. createDecoratorForEnhancer é€ ç¥å·¥å…·

> é¦–å…ˆï¼Œè°ƒç”¨ createPropDecorator å‡½æ•°æ‹¿åˆ° decoratorï¼Œç”³æ˜ä¸€ä¸ªå˜é‡ resï¼Œå°† enhancer æŒ‚åœ¨ä¸‹é¢ï¼Œç„¶åè¿”å› res
>
> åœ¨ createPropDecorator ä¼ äº†ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ booleanï¼Œç¬¬äºŒä¸ªæ˜¯**å‡½æ•°**
>
> è¯¥å‡½æ•°æ˜¯è£…é¥°å™¨çš„ä»£ç†å‡½æ•°ï¼Œæ˜¯ä¸ºäº†åœ¨ createDecoratorForEnhancer å±‚é¢ä¸Šæ‹¿åˆ° enhancer

![createDecoratorForEnhancer](./images/1/8.createDecoratorForEnhancer.jpg)

![createPropDecorator](./images/1/9.createPropDecorator.jpg)

3. è¿›å» createPropDecorator çœ‹çœ‹é‡Œé¢æ€ä¹ˆä½¿ç”¨è¿™ä¸ª`å‡½æ•°å‚æ•°`çš„

> å¯ä»¥çœ‹åˆ°æ•´ä½“æ˜¯ä¸ªåˆ›å»º decoratorFactory å·¥å‚çš„å‡½æ•°ï¼Œä¸»è¦å°±æ˜¯æ ¹æ® enhancer çš„ä¸åŒï¼Œè¿”å›ç›¸åº”çš„å·¥å‚
>
> åœ¨ decoratorFactory ä¸­ä¸»è¦å°±æ˜¯ç»Ÿä¸€äº† @decorator obj å’Œ @decorator('decoratorArguments') obj2 çš„ç”¨æ³•
>
> decorator å‡½æ•°è¿”å›çš„æ˜¯ createPropertyInitializerDescriptor æ‰§è¡Œçš„ç»“æœï¼Œå…¶å…·ä½“è¿”å›çš„æ˜¯ä¸ª descriptor
>
> å†ç”³æ˜ä¸€éï¼Œdecorator å‡½æ•°æ‰§è¡Œåè¿”å›çš„æ˜¯ descriptorï¼Œè€Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ **resultDescriptor**ï¼Œè§ `ç« èŠ‚ä¸€ æ­¥éª¤7`
>
> åœ¨ decoratorFactory æœ€åé€šè¿‡ quacksLikeADecorator åˆ¤æ–­è£…é¥°å™¨ä¸ºå“ªç§ç±»å‹
>
> å¦‚æœä¸º @decorator objï¼Œåˆ™ç›´æ¥ decorator è¿”å› descriptorï¼ˆdecorator.apply(null, arguments as any)ï¼‰
>
> å¦‚æœä¸º @decorator('decoratorArguments') obj2ï¼Œåˆ™è¿”å› decoratorï¼ˆåœ¨ä¹¦å†™æ—¶æ‰§è¡Œï¼‰
>
> å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé€šè¿‡ç¬¬äºŒç§æ–¹å¼ä¼ çš„å‚æ•°ï¼Œå°±æ˜¯ decoratorFactory çš„ arguments å¯¹è±¡ï¼Œæ‰€ä»¥ä¸ºå•¥ quacksLikeADecorator åˆ©ç”¨çš„æ˜¯ arguments æ¥åˆ¤æ–­

![createPropDecorator-2](./images/1/10.createPropDecorator-2.jpg)

4. çœ‹çœ‹ createPropertyInitializerDescriptor åˆ°åº•è¿”å›äº†å“ªäº›

> æ˜¯ä¸æ˜¯ç»ˆäºçœ‹åˆ°ç†Ÿæ‚‰çš„ getï¼Œset äº†ï¼Œé‡Œé¢è°ƒç”¨äº† initializeInstanceï¼Œè¿˜è®°å¾—åœ¨ `ç« èŠ‚ä¸€ æ­¥éª¤6` è¯´çš„è¿™ä¸ªå‡½æ•°å§
>
> åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢é™¤äº†æ·»åŠ  addHiddenPropï¼Œè¿˜è°ƒç”¨äº† propertyCreatorï¼Œè¿™å°±æ˜¯ `ç« èŠ‚äºŒ æ­¥éª¤3` createPropDecorator ä¼ è¿›æ¥çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç„¶åæ”¾è¿›äº† target[mobxPendingDecorators]![prop] å±æ€§ä¸­ï¼Œä¾› extendObservable ä½¿ç”¨
>
> æé†’ä¸€ä¸‹ï¼Œæ•´ä¸ª `ç« èŠ‚äºŒ` æ˜¯å»ºç«‹åœ¨ `ç« èŠ‚ä¸€ æ­¥éª¤5` ä¸­çš„
>
> initializeInstance åœ¨åˆå§‹åŒ– base ç©ºå¯¹è±¡ä¼šè°ƒç”¨ï¼Œæ“ä½œå¯¹è±¡æ—¶ä¹Ÿä¼šè°ƒç”¨

![createPropertyInitializerDescriptor](./images/1/11.createPropertyInitializerDescriptor.jpg)

5. propertyCreator åšäº†ä»€ä¹ˆå‘¢ï¼Œå›åˆ° `ç« èŠ‚äºŒ æ­¥éª¤2`ï¼Œçœ‹çœ‹ createPropDecorator ä¼ çš„ç¬¬äºŒä¸ªå‚æ•°

> èƒ½å‘ç°è°ƒç”¨äº†è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼šasObservableObjectï¼Œå…¶ä¼ å…¥å‚æ•°ä¸ºåŸå§‹å¯¹è±¡çš„ä¸€ä¸ªå±æ€§å€¼ï¼Œå¹¶ä¸”é“¾å¼è°ƒç”¨äº† addObservableProp
>
> å…¶å®æˆ‘ä»¬éƒ½å¯ä»¥çŒœæµ‹è¿™ä¸ªå‡½æ•°å¹²äº†å•¥ï¼Œå°±æ˜¯é€šè¿‡ enhancerï¼ŒæŠŠ propertyName å±æ€§èµ‹ä¸ŠåŠ«æŒåçš„ initialValue

### ä¸‰ã€asObservableObject å¯¹è±¡ç®¡ç†å™¨

1. çœ‹çœ‹ asObservableObject æ€ä¹ˆç®¡ç†å¯¹è±¡

> é€šè¿‡ targetï¼ˆè¢«è£…é¥°å™¨ä¿®é¥°çš„ targetï¼Œä¸ºæ•´ä¸ªå¯¹è±¡ï¼‰æ‹¿åˆ°å¯¹è±¡çš„ ObservableObjectAdministrationï¼ˆå¦‚æœå¯¹è±¡å±æ€§å€¼ä¹Ÿæ˜¯å¯¹è±¡ï¼Œåˆ™è¯¥å±æ€§å€¼ä¹Ÿä¼šæ‹¥æœ‰ admï¼‰
>
> å¹¶å°†å…¶æŒ‚åˆ° target çš„ $mobx å±æ€§ä¸‹ï¼Œæ–¹ä¾¿åé¢æš´éœ² api ä½¿ç”¨
>
> æ‹¿åˆ°å¯¹è±¡ç®¡ç†å™¨åè°ƒç”¨ addObservableProp æ–¹æ³•ï¼Œå°†å¯¹è±¡å½“å‰å±‚çš„å½“å‰ propertyName åŠ«æŒ

![asObservableObject](./images/1/13.asObservableObject.jpg)

2. ObservableObjectAdministration ç®¡ç†å™¨ï¼ˆåç®€ç§° admï¼‰

> å¯ä»¥çœ‹å‡º adm å…¶å®ä¹Ÿæ˜¯ä¸ªå°è£…ç±»ï¼Œå…·ä½“å›´ç»• values å±•å¼€ï¼Œè€Œ values æ˜¯ä¸ª Mapï¼Œé”®ä¸º PropertyKeyï¼Œå€¼ä¸º ObservableValue
>
> åƒ readï¼Œwrite ç­‰æ–¹æ³•ï¼Œæœ€åéƒ½æ˜¯è°ƒç”¨çš„ ObservableValue æä¾›çš„ api

![ObservableObjectAdministration](./images/1/14.ObservableObjectAdministration.jpg)

3. addObservableProp å¦‚ä½•å¡«å…… ObservableValue

> é€šè¿‡ new ObservableValue ä¼ å…¥ newValueã€enhancer å¾—åˆ°åŠ«æŒåçš„ observable
>
> å†å¡«å…… this.valuesï¼Œä¹‹åçš„æ“ä½œç»Ÿä¸€äº¤ç»™ adm ç®¡ç†

![addObservableProp](./images/1/15.addObservableProp.jpg)

4. ObservableValue å¦‚ä½•åŠ«æŒ

> å¯ä»¥çœ‹åˆ° ObservableValue å›´ç»• value å±•å¼€ï¼Œé€šè¿‡ enhancer è¿›è¡ŒåŠ«æŒï¼Œè¿™é‡Œæ‰çœŸæ­£çš„ä½¿ç”¨åˆ° enhancer
>
> è¿™é‡Œå¦‚æœè¢«åŠ«æŒå±æ€§å€¼ä¹Ÿæ˜¯å¯¹è±¡ï¼Œè°ƒç”¨ enhancer åŠ«æŒï¼Œåç»­ä¼š**é€’å½’ä¹‹å‰æ‰€æœ‰çš„æ­¥éª¤**
>
> æ­¤å¤– ObservableValue æä¾›äº† getï¼Œset æ–¹æ³•å’Œ Object çš„ apiï¼Œå¦‚ toString
>
> æœ€ååœ¨å›åˆ° `ç« èŠ‚äºŒ æ­¥éª¤4` æ¢³ç†ä¸‹ï¼šcreatePropertyInitializerDescriptor æ‰§è¡Œåè¿”å› get å’Œ setï¼Œå®ƒä»¬é‡Œé¢éƒ½è°ƒç”¨äº† initializeInstance
>
> initializeInstance è°ƒç”¨ç¼“å­˜å¥½çš„ propertyCreatorï¼Œé‡Œé¢é€šè¿‡ asObservableObject æ‹¿åˆ° adm æ¥è¿›è¡Œå„ç§æ“ä½œ

![ObservableValue](./images/1/16.ObservableValue.jpg)

5. set æ–¹æ³•åŠ å¼ºåŠ«æŒ

> å›å¿†æˆ‘ä»¬æ”¹å˜ä¸€ä¸ª observable å¯¹è±¡åï¼Œä¾ç„¶æ˜¯åŠ«æŒçš„å¯¹å§
>
> @observable obj = { a: 1 };
>
> obj = { b: 2, c: { d: 3 } };
>
> å…¶å®å°±æ˜¯å…ˆæŠŠæ–°å€¼åŠ«æŒä¸‹å†èµ‹å€¼

![ObservableValue set](./images/1/17.ObservableValue-set.jpg)

### å››ã€æš´éœ² api

> æˆ‘ä»¬çŸ¥é“ adm æ˜¯è¢«åŠ«æŒåçš„ object çš„æ ¸å¿ƒï¼Œæ‰€ä»¥æ‹¿åˆ° adm å°±å¯èƒ½è¿›è¡Œå„ç§æ“ä½œ
>
> é€šè¿‡ `ç« èŠ‚ä¸‰ æ­¥éª¤1` ç¼“å­˜çš„ $mobx å°±å¯ä»¥åŠåˆ°ï¼Œé—®é¢˜è¿åˆƒè€Œè§£

1. keys

![api-keys](./images/1/18.api-keys.jpg)

2. set

![api-set](./images/1/19.api-set.jpg)

## æœ€å

1. [å¸¦æ³¨é‡Šçš„ mobx æºç ](https://github.com/lawler61/mobx)

2. æ¬¢è¿åœ¨ [mobx æºç è§£è¯» issue](https://github.com/lawler61/blog/issues?q=is%3Aissue+is%3Aopen+label%3A%22mobx+%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%22) ä¸­è®¨è®º~

3. ç å­—ä¸æ˜“ï¼Œå–œæ¬¢çš„è®°å¾—ç‚¹ ğŸ’› å“¦
